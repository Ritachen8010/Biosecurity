{% extends "1_home.html" %}

{% block title %}Administrator - View/Edit Staff - | AGRICULTURAL | BIOSECURITY | PEST AND WEED{% endblock %}

{% block content %}

<div class="p-5 bg-light text-black text-center">
    <h1>Hello, {{ admin[2] + ' ' + admin[3] }}!</h1>
</div>

<nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid">
        <!-- Navi -->
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0 me-3">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('admin_home') }}">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('admin_m_agro') }}">View/Edit Agronomists Profile</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="{{ url_for('admin_m_staff') }}">View/Edit Staff Profile</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('admin_profile') }}">Personal Profile</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container-sm mb-2">
    <!-- Search bar -->
    <form class="d-flex mb-5">
        <input class="form-control-sm me-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success btn-sm" type="submit">Search</button>
    </form>

    <form action="{{ url_for('add_staff') }}" method="GET">
        <button type="submit" class="btn btn-primary mb-5">Add Staff</button>
    </form>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-dismissible {% if message == 'error' %}alert-danger{% elif message == 'success' %}
                alert-success{% endif %}" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h1>List of Staffs</h1>
    <table class="text-center mt-5 mx-auto w-80 table table-bordered">
        <thead>
            <tr>
                <th>Username</th>
                <th>Staff ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Work Phone Number</th>
                <th>Hire Date</th>
                <th>Position</th>
                <th>Department</th>
                <th>Email</th>
                <th>Status</th>
                <th>Action</th>
                <th>Delete</th>
                <th>Reset Password</th>
            </tr>
        </thead>
        <tbody>
            {% for staff in combined_list %}
                {% if staff[8] == 'staff' %}
                    <tr>
                        <td>{{ staff[6] }}</td>
                        <td>{{ staff[0] }}</td>
                        <td>{{ staff[1] }}</td>
                        <td>{{ staff[2] }}</td>
                        <td>{{ staff[3] }}</td>
                        <td>{{ staff[4] }}</td>
                        <td>{{ staff[8] }}</td>
                        <td>{{ staff[5] }}</td>
                        <td>{{ staff[7] }}</td>
                        <td>{{ staff[9] }}</td>
                        <td>
                            <form action="{{ url_for('update_staff', id=staff[0]) }}" method="GET">
                                <button type="submit" class="btn btn-primary">Edit</button>
                            </form>
                        </td>
                        <td>
                            <form action="{{ url_for('delete_staff', staff_id=staff[0]) }}" method="POST">
                                <input type="hidden" name="staff_id" value="{{ staff[0] }}">
                                <button type="submit" class="btn btn-danger" onclick="confirmDelete(event, {{ staff[0] }} )">Delete</button>
                            </form>
                        </td>
                        <td>
                            <form action="{{ url_for('reset_password_staff', staff_id=staff[0]) }}" method="POST">
                                <button type="submit" class="btn btn-primary">Reset</button>
                            </form>                        
                        </td>
                    </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <script>
        // confirmDelete for delete user
        function confirmDelete(event, staffId) {
            event.preventDefault(); // prevent form post
    
            if (confirm('Are you sure you want to delete this staff?')) {
                document.getElementById('deleteForm').submit();
            }
        }
    </script>
    
    
    <script>
        // close flash msg when close button is clicked
        document.querySelectorAll('.close').forEach(function(closeButton) {
            closeButton.addEventListener('click', function() {
                this.parentElement.style.display = 'none';
            });
        });
    </script>

<footer class="mt-5 p-5 bg-light text-black text-center relative-position">
    <h5>AGRICULTURAL | BIOSECURITY | PEST AND WEED</h5>
    </footer>
{% endblock %}
